# 场景题

## MySQL读写分离后，先写后查如何保障一致性

1. 程序运行中程序员自己生成字段值包括主键
2. 强制休眠，但是时间不好把控
3. 强制下一条select走主数据库  程序员可控，但是有性能瓶颈
4. MGR全同步复制（MGR就是当事务发生时，对事务产生一个全局唯一的ID然后将这个事务在集群中广播，等大多数从服务器同意之后才能提交，在主从没有完成同步之前不返回任何结果）

## MySQL与Redis数据一致性

1. 同时对MySQL和Redis进行更新，但是害怕网络故障或者程序异常
2. 异步更新引入消息队列，比如RabbitMQ，来异步更新Redis。
3. 基于binlog的更新，使用channel实时解析binlog，然后更新Redis。
4. 引入版本号或时间戳。更新数据时，除了更新MySQL和Redis的记录外，还要更新对应的版本号或时间戳，可以提高数据一致性的可靠性，但也会增加一定的复杂性和开销。
5. 使用Redis的事务支持，需要注意的是，Redis的事务并非严格的ACID事务，可能存在部分成功的情况
6. 分布式事务管理器，Atomikos、Bitronix