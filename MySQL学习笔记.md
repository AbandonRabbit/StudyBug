# 用户数据管理

## 管理用户

~~~sql
/*查询用户*/
SELECT * FROM user

/*创建用户*/
CREATE USER '用户名'@ '主机名' IDENTIFUED BY '密码'

/*修改用户密码*/
ALTER USER '用户名'@ '主机名' IDENTIFUED WITH mysql_native_password BY '新密码'

/*删除用户*/
DROPUSER '用户名'@ '主机名'
~~~

主机名可以用%通配符，表示任意

## 权限控制

~~~sql
/*查询权限*/
SHOW GRANTS FOR '用户名'@ '主机名'

/*授予权限*/
GRANT 权限列表 ON 数据库名.表名 TO '用户名'@ '主机名'

/*撤销权限*/
REVOKE 权限列表 ON 数据库名.表名 FROM '用户名'@ '主机名'
~~~

> 多个权限之间，可以使用逗号分隔
>
> 授权时，数据库名和表名可以使用 * 进行统配，表示所有

# 函数

## 字符串函数

| 函数                     | 功能                                                       |
| ------------------------ | ---------------------------------------------------------- |
| CONCAT(S1,S2,...Sn)      | 字符串拼接，将S1，S2，... Sn拼接成一个字符串               |
| LOWER(str)               | 将字符串str全部转为小写                                    |
| UPPER(str)               | 将字符串str全部转为大写                                    |
| LPAD(str,n,pad)          | 左填充，用字符串pad对str的左边进行填充，达到n个字符 串长度 |
| RPAD(str,n,pad)          | 右填充，用字符串pad对str的右边进行填充，达到n个字符 串长度 |
| TRIM(str)                | 去掉字符串头部和尾部的空格                                 |
| SUBSTRING(str,start,len) | 返回从字符串str从start位置起的len个长度的字符串            |

## 数值函数

| 函数       | 功能                               |
| ---------- | ---------------------------------- |
| CEIL(x)    | 向上取整                           |
| FLOOR(x)   | 向下取整                           |
| MOD(x,y)   | 返回x/y的模                        |
| RAND()     | 返回0~1内的随机数                  |
| ROUND(x,y) | 求参数x的四舍五入的值，保留y位小数 |

## 日期函数

| 函数                               | 功能                                             |
| ---------------------------------- | ------------------------------------------------ |
| CURDATE()                          | 返回当前日期                                     |
| CURTIME()                          | 返回当前时间                                     |
| NOW()                              | 返回当前日期和时间                               |
| YEAR(date)                         | 获取指定date的年份                               |
| MONTH(date)                        | 获取指定date的月份                               |
| DAY(date)                          | 获取指定date的日期                               |
| DATE_ADD(date, INTERVAL expr type) | 返回一个日期/时间值加上一个时间间隔expr后的 时间 |
| DATEDIFF(date1,date2)              | 返回起始时间date1 和 结束时间date2之间的天数     |

## 流程控制函数

| 函数                                                         | 功能                                                       |
| ------------------------------------------------------------ | ---------------------------------------------------------- |
| IF(value,t,f)                                                | 如果value为true，返回 t ，否则返回 f                       |
| IFNULL(v1,v2)                                                | 如果 v1 不为空，返回 v1，否则返回 v2                       |
| CASE WHEN [ val1 ] THEN [res1] ... ELSE [ default ] END      | 如果val1为true，返回res1，... 否 则返回default默认值       |
| CASE [ expr ] WHEN [ val1 ] THEN [res1] ... ELSE [ default ] END | 如果expr的值等于val1，返回 res1，... 否则返回default默认值 |

# 存储引擎

## MySQL的体系结构

- 第一层——连接层：接受客户端的链接，完成链接处理，认证授权，安全方案，检查最大链接数
- 第二层——服务层：SQL结构，解析器，查询优化器，缓存
- 第三层——存储引擎层：数据存储和提取的方式，索引在这一层实现
- 第四层——存储层：数据库的相关数据

## 存储引擎简介

存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式 。存储引擎是基于表的，而不是 基于库的，所以存储引擎也可被称为表类型。

~~~mysql
/*查询建表语句*/
show create table 表名;

/*建表时指定存储引擎*/
CREATE TABLE 表名(
    字段1 字段1类型 [ COMMENT 字段1注释 ] ,
) ENGINE = 引擎名 [ COMMENT 表注释 ] ;

/*查询当前数据库支持的存储引擎*/
show engines;
~~~

### InnoDB 存储引擎

在 MySQL 5.5 之后，InnoDB是默认的 MySQL 存储引擎。

#### 特点 

- DML操作遵循ACID模型，支持事务；
-  行级锁，提高并发访问性能； 
- 支持外键FOREIGN KEY约束，保证数据的完整性和正确性；

#### 文件

xxx.ibd：xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结 构（frm-早期的 、sdi-新版的）、数据和索引。

#### 逻辑存储结构

1. 表空间 : InnoDB存储引擎逻辑结构的最高层，ibd文件其实就是表空间文件，在表空间中可以 包含多个Segment段。 
2. 段 : 表空间是由各个段组成的， 常见的段有数据段、索引段、回滚段等。InnoDB中对于段的管 理，都是引擎自身完成，不需要人为对其控制，一个段中包含多个区。 
3. 区 : 区是表空间的单元结构，每个区的大小为1M。 默认情况下， InnoDB存储引擎页大小为 16K， 即一个区中一共有64个连续的页。 
4. 页 : 页是组成区的最小单元，页也是InnoDB 存储引擎磁盘管理的最小单元，每个页的大小默 认为 16KB。为了保证页的连续性，InnoDB 存储引擎每次从磁盘申请 4-5 个区。 
5. 行 : InnoDB 存储引擎是面向行的，也就是说数据是按行进行存放的，在每一行中除了定义表时 所指定的字段以外，还包含两个隐藏字段

### MyISAM 存储引擎

是MySQL早期的默认存储引擎

#### 特点

- 不支持事务，不支持外键
- 支持表锁，不支持行锁
- 访问速度快

#### 文件

- xxx.sdi：存储表结构信息
- xxx.MYD: 存储数据
- xxx.MYI: 存储索引

### Memory 存储引擎

Memory引擎的表数据时存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为 临时表或缓存使用。

#### 特点 

1. 内存存放
2. hash索引（默认）

#### 文件

- xxx.sdi：存储表结构信息

### 区别及特点



## 存储引擎选择

